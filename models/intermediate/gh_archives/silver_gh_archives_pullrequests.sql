{{
    config(
        materialized = 'table'
    )
}}

SELECT  id,
        type,
        actor_id, 
        actor_login, 
        actor_display_login, 
        actor_gravatar_id, 
        actor_url, 
        actor_avatar_url, 
        repo_id, 
        repo_name, 
        repo_url, 
        payload.action as payload_action,
        payload.number as payload_number, 
        payload.pull_request.id as payload_pull_request_id,
        payload.pull_request.url as payload_pull_request_url,
        payload.pull_request.html_url as payload_pull_request_html_url,
        payload.pull_request.diff_url as payload_pull_request_diff_url,
        payload.pull_request.patch_url as payload_pull_request_patch_url,
        payload.pull_request.issue_url as payload_pull_request_issue_url,
        payload.pull_request.commits_url as payload_pull_request_commits_url,
        payload.pull_request.review_comments_url as payload_pull_request_review_comments_url,
        payload.pull_request.review_comment_url as payload_pull_request_review_comment_url,
        payload.pull_request.comments_url as payload_pull_request_comments_url,
        payload.pull_request.statuses_url as payload_pull_request_statuses_url,
        payload.pull_request.number as payload_pull_request_number,
        payload.pull_request.title as payload_pull_request_title,
        payload.pull_request.user.id as payload_pull_request_user_id,
        payload.pull_request.user.login as payload_pull_request_user_login,
        payload.pull_request.user.display_login as payload_pull_request_user_display_login,
        payload.pull_request.user.gravatar_id as payload_pull_request_user_gravatar_id,
        payload.pull_request.user.url as payload_pull_request_user_url,
        payload.pull_request.user.avatar_url as payload_pull_request_user_avatar_url,
        payload.pull_request.body as payload_pull_request_body,
        payload.pull_request.state as payload_pull_request_state,
        payload.pull_request.locked as payload_pull_request_locked,
        payload.pull_request.assignee.id as payload_pull_request_assignee_id,
        payload.pull_request.assignee.login as payload_pull_request_assignee_login,
        payload.pull_request.assignee.display_login as payload_pull_request_assignee_display_login,
        payload.pull_request.assignee.gravatar_id as payload_pull_request_assignee_gravatar_id,
        payload.pull_request.assignee.url as payload_pull_request_assignee_url,
        payload.pull_request.assignee.avatar_url as payload_pull_request_assignee_avatar_url,
        payload.pull_request.merged_by.id as payload_pull_request_merged_by_id,
        payload.pull_request.merged_by.login as payload_pull_request_merged_by_login,
        payload.pull_request.merged_by.display_login as payload_pull_request_merged_by_display_login,
        payload.pull_request.merged_by.gravatar_id as payload_pull_request_merged_by_gravatar_id,
        payload.pull_request.merged_by.url as payload_pull_request_merged_by_url,
        payload.pull_request.merged_by.avatar_url as payload_pull_request_merged_by_avatar_url,
        payload.pull_request.head.label as payload_pull_request_head_label,
        payload.pull_request.base.user.login as payload_pull_request_base_user_login,
        payload.pull_request.labels as payload_pull_request_labels,
        payload.pull_request.comments as payload_pull_request_comments,
        payload.pull_request.review_comments as payload_pull_request_review_comments,
        payload.pull_request.commits as payload_pull_request_commits,
        payload.pull_request.additions as payload_pull_request_additions,
        payload.pull_request.deletions as payload_pull_request_deletions,
        payload.pull_request.changed_files as payload_pull_request_changed_files,
        public, 
        created_at, 
        org_id,
        org_login,
        org_gravatar_id,
        org_url,
        org_avatar_url,
        now() AS ingest_timestamp
    FROM 
        {{ ref('silver_gh_archives_daily') }}
    WHERE 
        type = 'PullRequestEvent'
